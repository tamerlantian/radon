<div class="card mb-5">
  <div class="card-header">
    <h3 class="card-title">Viajes</h3>
    <button class="btn btn-primary" routerLink="/transporte/viaje/nuevo">Nuevo</button>
  </div>
  <div class="card-body">
    <div class="grid grid-cols-2 gap-4">
      @for (viaje of viajes(); track viaje.datos.id) {
        <div>
          <div class="travel-card">
            <!-- Main travel info -->
            <div class="travel-header">
              <div class="travel-route-container">
                <div class="travel-route">
                  <span class="origin">{{ viaje.datos.ciudad_origen__nombre }}</span>
                  <i class="ki-duotone ki-arrow-right text-primary mx-2">
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>
                  <span class="destination">{{ viaje.datos.ciudad_destino__nombre }}</span>
                </div>
                <div class="travel-date">{{ viaje.datos.fecha | date: 'dd/MM/yyyy' }}</div>
              </div>
              <button
                class="btn btn-icon btn-sm btn-light-primary edit-btn"
                [routerLink]="['/transporte/viaje/editar', viaje.datos.id]"
              >
                <i class="ki-duotone ki-pencil fs-7">
                  <span class="path1"></span>
                  <span class="path2"></span>
                </i>
              </button>
            </div>

            <div class="travel-details">
              <div class="detail-row">
                <span class="label">Cliente:</span>
                <span class="value">{{ viaje.datos.cliente }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Servicio:</span>
                <span class="value">{{ viaje.datos.servicio__nombre }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Producto:</span>
                <span class="value">{{ viaje.datos.producto__nombre }}</span>
              </div>
              <div class="grid grid-cols-4 gap-1 mt-2 p-2 bg-gray-50 rounded">
                <div class="text-center">
                  <span class="block text-xs font-bold text-gray-800">
                    {{ viaje.datos.unidades }}
                  </span>
                  <span class="text-[10px] text-gray-500 uppercase tracking-tight">Unidades</span>
                </div>
                <div class="text-center">
                  <span class="block text-xs font-bold text-gray-800">
                    {{ viaje.datos.peso }}kg
                  </span>
                  <span class="text-[10px] text-gray-500 uppercase tracking-tight">Peso</span>
                </div>
                <div class="text-center">
                  <span class="block text-xs font-bold text-gray-800">
                    {{ viaje.datos.volumen }}mÂ³
                  </span>
                  <span class="text-[10px] text-gray-500 uppercase tracking-tight">Volumen</span>
                </div>
                <div class="text-center">
                  <span class="block text-xs font-bold text-gray-800">
                    {{ viaje.datos.puntos_entrega }}
                  </span>
                  <span class="text-[10px] text-gray-500 uppercase tracking-tight">Puntos</span>
                </div>
              </div>
            </div>

            <!-- Proposals section -->
            <div class="proposals-section">
              <h6 class="proposals-title">Propuestas ({{ viaje.propuestas.length }})</h6>
              @if (viaje.propuestas.length === 0) {
                <div class="no-proposals">
                  <span class="text-muted">No hay propuestas disponibles</span>
                </div>
              } @else {
                <div class="proposals-list">
                  @for (propuesta of viaje.propuestas; track propuesta.id) {
                    <div class="proposal-item" [class.accepted]="propuesta.estado_aceptado">
                      <div class="proposal-info">
                        <div class="company-name">
                          <i class="ki-duotone ki-office-bag text-primary me-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                          </i>
                          {{ propuesta.empresa }}
                        </div>
                        <div class="proposal-price">${{ propuesta.precio | number: '1.0-0' }}</div>
                        <div class="proposal-date">{{ propuesta.fecha | date: 'dd/MM/yyyy' }}</div>
                      </div>
                      @if (!propuesta.estado_aceptado) {
                        <button
                          class="btn btn-sm btn-success accept-btn"
                          (click)="aceptarPropuesta(propuesta.id)"
                        >
                          Aceptar
                        </button>
                      } @else {
                        <span class="badge badge-success">Aceptada</span>
                      }
                    </div>
                  }
                </div>
              }
            </div>

            <!-- @if (viaje.datos.comentario) {
              <div class="travel-comment">
                <i class="ki-duotone ki-message-text-2 text-primary me-2">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                </i>
                {{ viaje.datos.comentario }}
              </div>
            } -->
          </div>
        </div>
      }
    </div>
  </div>
</div>
